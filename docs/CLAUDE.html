<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Claude Code Guidelines for R Package Development ‚Ä¢ heplots</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png"><link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Claude Code Guidelines for R Package Development"><meta property="og:image" content="https://friendly.github.io/heplots/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">heplots</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/datasets.html">Data sets in the heplots package</a></li>
    <li><a class="dropdown-item" href="articles/HE_manova.html">HE plot MANOVA Examples</a></li>
    <li><a class="dropdown-item" href="articles/HE_mmra.html">HE plot MMRA Examples</a></li>
    <li><a class="dropdown-item" href="articles/Robust.html">Robust Multivariate Linear Models</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/friendly/heplots/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Claude Code Guidelines for R Package Development</h1>
      <small class="dont-index">Source: <a href="https://github.com/friendly/heplots/blob/HEAD/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claude-code-guidelines-for-r-package-development" class="section level1">

<p>This file provides guidelines for Claude Code when working on R packages, particularly focused on statistical visualization and multivariate analysis packages like heplots.</p>
<div class="section level2">
<h2 id="code-style-preferences">Code Style Preferences<a class="anchor" aria-label="anchor" href="#code-style-preferences"></a></h2>
<div class="section level3">
<h3 id="string-formatting-and-console-output">String Formatting and Console Output<a class="anchor" aria-label="anchor" href="#string-formatting-and-console-output"></a></h3>
<p><strong>PREFER</strong> <code><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue::glue()</a></code> for string interpolation and console output, but <code><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste()</a></code> and <code><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0()</a></code> are also OK. Avoid <code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Processing {n} observations from {ngroups} groups"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Groups {paste(singular_groups, collapse = ', ')} have been excluded"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Chi-Sq statistic: {round(statistic, 4)}\n"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># OK</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Processing"</span>, <span class="va">n</span>,  <span class="st">"observations from"</span>, <span class="va">ngroups</span>, <span class="st">"groups"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Chi-Sq statistic:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">statistic</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Avoid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Processing %d observations from %d groups"</span>, <span class="va">n</span>, <span class="va">ngroups</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Processing"</span>, <span class="va">n</span>, <span class="st">"observations from"</span>, <span class="va">ngroups</span>, <span class="st">"groups"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Benefits</strong>: More readable, cleaner syntax, explicit variable interpolation.</p>
<p><strong>Package Setup</strong>: - Add <code>Suggests: glue</code> to DESCRIPTION file - Add <code>@importFrom glue glue</code> in any R file (typically in a utils.R or package-doc.R file)</p>
</div>
<div class="section level3">
<h3 id="vectorization-over-loops">Vectorization Over Loops<a class="anchor" aria-label="anchor" href="#vectorization-over-loops"></a></h3>
<p><strong>ALWAYS</strong> prefer vectorized solutions over explicit loops when possible. I‚Äôm not ready to go full-blown <code>purrr</code> versions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good - Vectorized</span></span>
<span><span class="va">logdet_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="va">nlev</span><span class="op">)</span></span>
<span><span class="va">logdet_all</span><span class="op">[</span><span class="va">valid_idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">mats</span><span class="op">[</span><span class="va">valid_idx</span><span class="op">]</span>, <span class="va">det</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Avoid - Explicit loop</span></span>
<span><span class="va">logdet_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="va">nlev</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">valid_idx</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">logdet_all</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/det.html" class="external-link">det</a></span><span class="op">(</span><span class="va">mats</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Good - Using apply family</span></span>
<span><span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">groups</span>, <span class="kw">function</span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">group</span> <span class="op">==</span> <span class="va">g</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Good - Using Map/mapply for parallel iteration</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span> <span class="op">+</span> <span class="va">offset</span>, <span class="va">xvals</span>, <span class="va">yvals</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Avoid - Manual loop</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xvals</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">xvals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">xvals</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">yvals</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">offset</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="keeping-track-of-changes">Keeping track of changes<a class="anchor" aria-label="anchor" href="#keeping-track-of-changes"></a></h3>
<p>In <code>R/</code> source files, I like to keep track of <code>TODO</code> and <code>FIXME</code> items, changing the status to <code>DONE</code> when they are completed. I started using the style below in initial comments, which appear in the initial lines of a file as simple <code>#</code> comments, before the roxygen documentation comments, <code>#'</code> begin. Please use this style when making changes. Note that one example includes a timestamp, which would be useful when you make such changes.</p>
<p>Some examples of this style:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># DONE: ‚úîÔ∏è handles singular covariance matrices</span></span>
<span><span class="co"># DONE: ‚úîÔ∏è Fixed summary() method to print eigenvalues as a matrix (not a list)</span></span>
<span><span class="co"># DONE: ‚úîÔ∏è print/summary methods now show the number of groups actually used when some are excluded</span></span>
<span><span class="co"># TODO: üö© Don't need "htest" because there's a `print.boxM()` method</span></span>
<span><span class="co"># TODO: üö© simplify print and summary methods, now the `ngroups` is saved by boxM.default</span></span>
<span></span>
<span><span class="co"># DONE: ‚úîÔ∏è Now allow to plot multiple variables in a scatterplot matrix format 3/30/2016 10:53:05 AM</span></span>
<span><span class="co"># FIXME: ‚ùå The covEllipses.boxM method gives errors.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="function-documentation">Function Documentation<a class="anchor" aria-label="anchor" href="#function-documentation"></a></h3>
<p>Follow roxygen2 conventions with clear, complete documentation.</p>
<p>This should use markdown style (<code>text</code>) where possible, rather than the old Rd style () and similarly for the mention of linked functions (<code><a href="reference/heplot.html">heplot()</a></code>, <code><a href="https://rdrr.io/r/graphics/text.html" class="external-link">graphics::text()</a></code>) rather than <code>code{\link{heplots}}</code> or `</p>
<p>When there are long lines, e.g., in an <code>@param</code>, I prefer them to be wrapped at ~ 72 characters and subsequent lines indented by 8 characters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Label an Ellipse</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @description </span></span>
<span><span class="co">#' Draws a text label on an ellipse at its center or around the periphery.</span></span>
<span><span class="co">#' Provides flexible positioning using numeric indices, compass directions,</span></span>
<span><span class="co">#' or automatic placement based on the correlation structure.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param ellipse A 2-column matrix of (x,y) coordinates defining the ellipse</span></span>
<span><span class="co">#' @param label Character string for the label text</span></span>
<span><span class="co">#' @param col Color for the label text. Default: "black"</span></span>
<span><span class="co">#' @param label.pos Position for label. Can be:</span></span>
<span><span class="co">#'   * `NULL` (default): automatic based on correlation sign</span></span>
<span><span class="co">#'   * Integer 0-4: center, bottom, left, top, right</span></span>
<span><span class="co">#'   * Cardinal directions: "C", "N", "S", "E", "W"</span></span>
<span><span class="co">#'   * Diagonal directions: "NE", "SE", "SW", "NW"</span></span>
<span><span class="co">#'   * Numeric value 0-1: fractional position around ellipse</span></span>
<span><span class="co">#' @param ... Additional arguments passed to \code{\link{text}}</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return Invisibly returns the coordinates where the label was placed</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' # Create an ellipse</span></span>
<span><span class="co">#' library(car)</span></span>
<span><span class="co">#' ell &lt;- ellipse(c(0,0), shape=matrix(c(1, 0.5, 0.5, 1), 2, 2), radius=2)</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' # Label at different positions</span></span>
<span><span class="co">#' plot(ell, type="l", asp=1)</span></span>
<span><span class="co">#' label.ellipse(ell, "NE corner", label.pos="NE", col="blue")</span></span>
<span><span class="co">#' label.ellipse(ell, "Center", label.pos="C", col="red")</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span></code></pre></div>
<div class="section level4">
<h4 id="rdname">@rdname<a class="anchor" aria-label="anchor" href="#rdname"></a></h4>
<p>When multiple functions are documented in a single R file, use <code>@rdname</code> for all after the first with the same name as the first.</p>
</div>
</div>
<div class="section level3">
<h3 id="error-handling-and-validation">Error Handling and Validation<a class="anchor" aria-label="anchor" href="#error-handling-and-validation"></a></h3>
<p>Provide clear, informative error messages. When possible, include information about what in the arguments caused an error.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Y must be a matrix, got {class(Y)[1]}"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ellipse</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"ellipse must have 2 columns (x, y), got {ncol(ellipse)} columns"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check for valid label.pos values</span></span>
<span><span class="va">valid_positions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"N"</span>, <span class="st">"S"</span>, <span class="st">"E"</span>, <span class="st">"W"</span>, <span class="st">"NE"</span>, <span class="st">"SE"</span>, <span class="st">"SW"</span>, <span class="st">"NW"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">label.pos</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="va">label.pos</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">valid_positions</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Invalid label.pos: '{label.pos}'. Must be one of: {paste(valid_positions, collapse = ', ')}"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="warnings-with-context">Warnings with Context<a class="anchor" aria-label="anchor" href="#warnings-with-context"></a></h3>
<p>Make warnings informative and actionable:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good</span></span>
<span><span class="va">singular</span> <span class="op">&lt;-</span> <span class="va">dfs</span> <span class="op">&lt;</span> <span class="va">p</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">singular</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">singular_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dfs</span><span class="op">)</span><span class="op">[</span><span class="va">singular</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span></span>
<span>    <span class="st">"Groups {paste(singular_groups, collapse = ', ')} have fewer observations "</span>,</span>
<span>    <span class="st">"than variables (n &lt;= p) and have been excluded from calculations."</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Avoid vague warnings</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Some groups have issues"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="package-development-practices">Package Development Practices<a class="anchor" aria-label="anchor" href="#package-development-practices"></a></h2>
<div class="section level3">
<h3 id="recording-changes">Recording changes<a class="anchor" aria-label="anchor" href="#recording-changes"></a></h3>
<p>In the initial lines of functions, before the roxygen documentation, I use ordinary comments to record <code>TODO:</code>, <code>FIXME:</code> and <code>DONE:</code> items as follows. Continue this practice</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># DONE: ‚úîÔ∏è Generalize the `label.pos` argument to accept, in addition to values `0:4` and corresponding compass </span></span>
<span><span class="co">#       directions, N, S, E, W values: `NE`, `SE`, `SW`, `NW` to mean at circular angles 45, 135, 225, 315</span></span>
<span><span class="co"># FIXME: Allow to use `tweak` for diagonal positions.</span></span>
<span><span class="co"># TODO: Generalize to allow a vector of `label`, with corresponding vectors `label.pos`</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="backward-compatibility">Backward Compatibility<a class="anchor" aria-label="anchor" href="#backward-compatibility"></a></h3>
<p>When extending functionality, maintain backward compatibility. Warn if any proposed change will break this.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extend existing arguments rather than breaking them</span></span>
<span><span class="co"># OLD: label.pos accepts 0:4 and "N", "S", "E", "W"</span></span>
<span><span class="co"># NEW: Also accepts "NE", "SE", "SW", "NW"</span></span>
<span><span class="co"># Ensure old code still works exactly as before</span></span>
<span></span>
<span><span class="co"># Use match.arg() for character arguments</span></span>
<span><span class="va">label.pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">label.pos</span>, </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"N"</span>, <span class="st">"S"</span>, <span class="st">"E"</span>, <span class="st">"W"</span>, <span class="st">"NE"</span>, <span class="st">"SE"</span>, <span class="st">"SW"</span>, <span class="st">"NW"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="return-values">Return Values<a class="anchor" aria-label="anchor" href="#return-values"></a></h3>
<p>Be explicit about return values, even for side-effect functions:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good</span></span>
<span><span class="va">label.ellipse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ellipse</span>, <span class="va">label</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># ... plotting code ...</span></span>
<span>  </span>
<span>  <span class="co"># Return coordinates for potential further use</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">label_x</span>, y <span class="op">=</span> <span class="va">label_y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-organization">Code Organization<a class="anchor" aria-label="anchor" href="#code-organization"></a></h3>
<p>Structure functions logically:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">function_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">args</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># 1. Input validation and preprocessing</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># 2. Handle special cases</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">label.pos</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">label.pos</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">cor_xy</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="st">"N"</span> <span class="kw">else</span> <span class="st">"S"</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># 3. Main computation</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">compute_something</span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># 4. Post-processing</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">format_result</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># 5. Return</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h2>
<p>I‚Äôm not quite ready to use <code><a href="https://usethis.r-lib.org/reference/use_testthat.html" class="external-link">usethis::use_testthat()</a></code> for this package. But when I do, I would like clear recommendations for what to test and how to test them.</p>
</div>
<div class="section level2">
<h2 id="graphics-and-visualization">Graphics and Visualization<a class="anchor" aria-label="anchor" href="#graphics-and-visualization"></a></h2>
<div class="section level3">
<h3 id="base-graphics-focus">Base Graphics Focus<a class="anchor" aria-label="anchor" href="#base-graphics-focus"></a></h3>
<p>This package uses base R graphics. Maintain consistency:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good - Using base graphics functions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, labels <span class="op">=</span> <span class="va">label</span>, col <span class="op">=</span> <span class="va">col</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ellipse</span>, col <span class="op">=</span> <span class="va">line.col</span>, lwd <span class="op">=</span> <span class="va">lwd</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># When adding to existing plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Respect user's par() settings</span></span>
<span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>no.readonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="coordinate-calculations">Coordinate Calculations<a class="anchor" aria-label="anchor" href="#coordinate-calculations"></a></h3>
<p>For geometric calculations (ellipses, angles, positions):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use clear variable names</span></span>
<span><span class="va">target_angle</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">label.pos</span>,</span>
<span>                       <span class="st">"NE"</span> <span class="op">=</span> <span class="va">pi</span><span class="op">/</span><span class="fl">4</span>,</span>
<span>                       <span class="st">"SE"</span> <span class="op">=</span> <span class="op">-</span><span class="va">pi</span><span class="op">/</span><span class="fl">4</span>,</span>
<span>                       <span class="st">"SW"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">3</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">4</span>,</span>
<span>                       <span class="st">"NW"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ensure angle ranges are consistent</span></span>
<span><span class="co"># atan2() returns [-pi, pi], so convert target angles to same range</span></span>
<span><span class="va">target_angle</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">target_angle</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">pi</span></span>
<span></span>
<span><span class="co"># Vectorize angle calculations</span></span>
<span><span class="va">angles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">atan2</a></span><span class="op">(</span><span class="va">ellipse</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">ellipse</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">angle_diffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">angles</span> <span class="op">-</span> <span class="va">target_angle</span><span class="op">)</span></span>
<span><span class="va">closest_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">angle_diffs</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="testing-and-debugging">Testing and Debugging<a class="anchor" aria-label="anchor" href="#testing-and-debugging"></a></h2>
<div class="section level3">
<h3 id="create-comprehensive-test-scripts">Create Comprehensive Test Scripts<a class="anchor" aria-label="anchor" href="#create-comprehensive-test-scripts"></a></h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># test_label_ellipse.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://friendly.github.io/heplots/">heplots</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/" class="external-link">car</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test all label positions</span></span>
<span><span class="va">positions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"N"</span>, <span class="st">"S"</span>, <span class="st">"E"</span>, <span class="st">"W"</span>, <span class="st">"NE"</span>, <span class="st">"SE"</span>, <span class="st">"SW"</span>, <span class="st">"NW"</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create test ellipse</span></span>
<span><span class="va">ell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/Ellipses.html" class="external-link">ellipse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visual test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">pos</span> <span class="kw">in</span> <span class="va">positions</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ell</span>, type <span class="op">=</span> <span class="st">"l"</span>, asp <span class="op">=</span> <span class="fl">1</span>, main <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"label.pos = '{pos}'"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="reference/label.ellipse.html">label.ellipse</a></span><span class="op">(</span><span class="va">ell</span>, label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"pos={pos}"</span><span class="op">)</span>, label.pos <span class="op">=</span> <span class="va">pos</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Programmatic tests</span></span>
<span><span class="va">test_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/label.ellipse.html">label.ellipse</a></span><span class="op">(</span><span class="va">ell</span>, <span class="st">"test"</span>, label.pos <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">test_coords</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">test_coords</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="package-specific-conventions">Package-Specific Conventions<a class="anchor" aria-label="anchor" href="#package-specific-conventions"></a></h2>
<div class="section level3">
<h3 id="for-heplots-package-specifically">For heplots package specifically:<a class="anchor" aria-label="anchor" href="#for-heplots-package-specifically"></a></h3>
<ul><li>
<strong>Ellipse matrices</strong>: I use 2-column matrices with (x, y) coordinates for 2D plots, 3-column matrices, (x, y, z) for 3D plots like <code><a href="reference/heplot3d.html">heplot3d()</a></code>.</li>
<li>
<strong>Color arguments</strong>: Use <code>col</code> for main colors. Various functions allow this to be a vector, applied to relevant objects.</li>
<li>
<strong>Drawing ellipses</strong>: These functions have a <code>fill = TRUE/FALSE</code> argument to allow ellipses to be filled; there is usually also a <code>fill.alpha</code> argument which is applied to the <code>col</code> color, via <code><a href="reference/trans.colors.html">trans.colors()</a></code>.</li>
<li>
<strong>Size arguments</strong>: Use <code>size</code> for relative sizing, <code>radius</code> for absolute</li>
<li>
<strong>Label positioning</strong>: Flexible system accepting multiple input types</li>
<li>
<strong>S3 methods</strong>: Provide <code>default</code>, <code>lm</code>, <code>mlm</code> methods where appropriate</li>
</ul></div>
<div class="section level3">
<h3 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prefer base R when possible</span></span>
<span><span class="co"># Use these packages when needed:</span></span>
<span><span class="co"># - car: for ellipse(), dataEllipse()</span></span>
<span><span class="co"># - MASS: for canonical discriminant analysis</span></span>
<span><span class="co"># - glue: for string formatting (preferred over sprintf)</span></span>
<span><span class="co">#   Use glue::glue() notation (don't import entire package)</span></span>
<span></span>
<span><span class="co"># In DESCRIPTION:</span></span>
<span><span class="co"># Imports: car</span></span>
<span><span class="co"># Suggests: MASS, glue, rgl (for 3D plotting)</span></span>
<span></span>
<span><span class="co"># In R/utils.R or R/heplots-package.R:</span></span>
<span><span class="co">#' @importFrom glue glue</span></span>
<span><span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># This allows glue::glue() to work throughout the package</span></span>
<span><span class="co"># Alternative: put @importFrom glue glue in the roxygen docs of any function that uses it</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="common-patterns-in-this-package">Common Patterns in This Package<a class="anchor" aria-label="anchor" href="#common-patterns-in-this-package"></a></h2>
<div class="section level3">
<h3 id="handling-different-input-types">Handling Different Input Types<a class="anchor" aria-label="anchor" href="#handling-different-input-types"></a></h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pattern for flexible input handling</span></span>
<span><span class="va">process_input</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obj</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">obj</span>, <span class="st">"lm"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Extract data from lm object</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span>    <span class="va">terms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/terms.html" class="external-link">terms</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span>    <span class="co"># ... </span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Use matrix directly</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">obj</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Unsupported object type: {class(obj)[1]}"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Continue with unified processing</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="covariance-matrix-calculations">Covariance Matrix Calculations<a class="anchor" aria-label="anchor" href="#covariance-matrix-calculations"></a></h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for singular matrices</span></span>
<span><span class="va">singular</span> <span class="op">&lt;-</span> <span class="va">dfs</span> <span class="op">&lt;</span> <span class="va">p</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">singular</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Handle gracefully, warn user, exclude from calculations</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Vectorized covariance calculation</span></span>
<span><span class="va">cov_mats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">groups</span><span class="op">)</span>, <span class="va">cov</span><span class="op">)</span></span>
<span><span class="va">valid_mats</span> <span class="op">&lt;-</span> <span class="va">cov_mats</span><span class="op">[</span><span class="op">!</span><span class="va">singular</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="file-organization">File Organization<a class="anchor" aria-label="anchor" href="#file-organization"></a></h2>
<p>In what is shown below, I heavily use <code>dev/</code> for testing changes or new additions to functions that go in <code>R/</code>.</p>
<pre><code>package/
‚îú‚îÄ‚îÄ R/
‚îÇ   ‚îú‚îÄ‚îÄ boxM.R           # Box's M test
‚îÇ   ‚îú‚îÄ‚îÄ heplot.R         # Main HE plot functions
‚îÇ   ‚îú‚îÄ‚îÄ label-ellipse.R  # Ellipse labeling utilities
‚îÇ   ‚îî‚îÄ‚îÄ utils.R          # Helper functions
‚îú‚îÄ‚îÄ issues               # Keep track of issues
‚îú‚îÄ‚îÄ man/                 # Generated by roxygen2
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ testthat/        # Unit tests
‚îú‚îÄ‚îÄ dev/                 # Development scripts
‚îÇ   ‚îú‚îÄ‚îÄ test_*.R         # Manual test scripts
‚îÇ   ‚îî‚îÄ‚îÄ scratch.R        # Experimental code
‚îî‚îÄ‚îÄ vignettes/           # Package documentation</code></pre>
</div>
<div class="section level2">
<h2 id="git-commit-messages">Git Commit Messages<a class="anchor" aria-label="anchor" href="#git-commit-messages"></a></h2>
<p>Write clear, descriptive commit messages:</p>
<pre><code><span><span class="va">Good</span><span class="op">:</span></span>
<span><span class="op">-</span> <span class="st">"Add diagonal compass directions (NE, SE, SW, NW) to label.ellipse()"</span></span>
<span><span class="op">-</span> <span class="st">"Fix boxM() to handle singular covariance matrices"</span></span>
<span><span class="op">-</span> <span class="st">"Vectorize angle calculations in label.ellipse()"</span></span>
<span></span>
<span><span class="va">Avoid</span><span class="op">:</span></span>
<span><span class="op">-</span> <span class="st">"Update function"</span></span>
<span><span class="op">-</span> <span class="st">"Fix bug"</span></span>
<span><span class="op">-</span> <span class="st">"Changes"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="notes-for-claude-code">Notes for Claude Code<a class="anchor" aria-label="anchor" href="#notes-for-claude-code"></a></h2>
<ul><li>
<strong>Always check</strong> for existing helper functions before creating new ones</li>
<li>
<strong>Read the package</strong> NAMESPACE and existing code structure first</li>
<li>
<strong>Test thoroughly</strong> with edge cases (singular matrices, small samples, etc.)</li>
<li>
<strong>Document</strong> all changes, including rationale for design decisions</li>
<li>
<strong>Preserve</strong> existing function signatures and return types</li>
<li>
<strong>Use</strong> consistent naming: snake_case for internal functions, camelCase for exported functions (follow existing package convention)</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Friendly, John Fox, Georges Monette.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

